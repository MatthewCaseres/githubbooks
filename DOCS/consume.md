# Consuming Configuration Files

## getAllRoutesInfo
`getAllRoutes` takes our URL trees and flattens them to an object that looks like this: 
```json
{
  "Open-EdTech/mdxbook/about.md": {
    "rawUrl": "https://raw.githubusercontent.com/Open-EdTech/mdxbook/main/DOCS/about.md",
    "ghUrl": "https://github.com/Open-EdTech/mdxbook/blob/main/DOCS/about.md",
    "route": "Open-EdTech/mdxbook/about.md",
    "index": 0,
    "treePath": [0]
  },
  "Open-EdTech/mdxbook/generate.md": {
    "rawUrl": "https://raw.githubusercontent.com/Open-EdTech/mdxbook/main/DOCS/generate.md",
    "ghUrl": "https://github.com/Open-EdTech/mdxbook/blob/main/DOCS/generate.md",
    "route": "Open-EdTech/mdxbook/generate.md",
    "index": 0,
    "treePath": [1]
  }
}
```
This flattening is useful when you need a big list of all the routes that should be dynamically generated by your framework, in my case Next.js. The object above was generated by this script: 
```js
var {summaryToUrlTree, getAllRoutesInfo} = require('mdxbook');

(async () => {
  const docsTree = await summaryToUrlTree({
    url: "https://github.com/Open-EdTech/mdxbook/blob/main/DOCS/DOCS.md",
  })
  console.log(getAllRoutesInfo([docsTree]));
})()
```

## Usage with Next.js

### getStaticPaths
We can use this `allRoutesInfo` object's keys to specify the dynamic routes to create in getStaticPaths for a file named [...id].tsx.
```js
import { GetStaticPaths, GetStaticProps } from "next";
import { getAllRoutesInfo } from "next-mdx-books";
import bookConfig from '../bookConfig.json'

export const getStaticPaths = async () => {
  const allRoutesInfo = await getAllRoutesInfo(bookConfig);
  return {
    paths: Object.keys(allRoutesInfo).map((routeString) => ({
      params: {
        id: routeString.split("/"),
      },
    })),
    fallback: false,
  };
};
```
### getStaticProps
In getStaticProps we can grab some information to pass down to our page. Here, we grab the `urlTree` so that each page can display a table of contents in the side navigation. We get the GitHub url, `ghUrl`, to add an 'edit this page' feature. 
```js
import { getMdSource, getAllRoutesInfo } from "next-mdx-books";
import renderToString from "next-mdx-remote/render-to-string";
import hydrate, { Source } from "next-mdx-remote/hydrate";
import bookConfig from '../bookConfig.json'

export const getStaticProps: GetStaticProps = async ({ params }) => {
  const allRoutesInfo = await getAllRoutesInfo(bookConfig);
  const stringRoute = (params!.id as string[]).join("/");
  const nodeIndex = allRoutesInfo[stringRoute].index;
  const ghUrl = allRoutesInfo[stringRoute].ghUrl;
  const urlTree = bookConfig[nodeIndex];
  const source = await getMdSource(stringRoute, allRoutesInfo, remote);
  const mdxSource = await renderToString(source);
  return {
    props: { urlTree, mdxSource, stringRoute, ghUrl }, // will be passed to the page component as props
  };
};
//From openedtech.dev
function Post({ urlTree, mdxSource, ghUrl }: { urlTree: UrlNode; mdxSource: Source, ghUrl: string }) {
  const content = hydrate(mdxSource);
  return (
      <SideBarProvider config={urlTree.children as StatefulNode[]}>
        <SideBar ghUrl={ghUrl}>
          <div className="prose dark:prose-dark max-w-sm sm:max-w-md lg:max-w-xl xl:max-w-2xl m-auto px-2 flex-1 ">
            <div>{content}</div>
          </div>
        </SideBar>
      </SideBarProvider>
  );
}
```
### Local Development
If you generated the local paths for a file as discussed in the "Generate Configurations" document, then you will be able to pass `false` as the third argument of `getMdSource` to build your pages from the local files for all local books.
```js
const source = await getMdSource(stringRoute, allRoutesInfo, false);
```